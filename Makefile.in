EXTENSIONS=@EXTENSIONS@
INSTALL=@INSTALL@
CONFIG_GENERATED=Makefile config.cache config.log config.status \
                 autom4te*.cache gc/Makefile
.PHONY: test clean install


all : gc/libgc.a src/gosh
	cd ext; $(MAKE) all
	cd doc; $(MAKE) all

gc/libgc.a :
	cd gc; $(MAKE) 

src/gosh : gc/libgc.a
	cd src; $(MAKE) 

test : src/gosh
	cd src; $(MAKE) test
	cd ext; $(MAKE) test

link : all
	cd ext; $(MAKE) link

unlink :
	cd ext; $(MAKE) unlink

clean : unlink
	rm -rf core *~
	cd gc; $(MAKE) clean
	cd src; $(MAKE) clean
	cd lib; $(MAKE) clean
	cd test; $(MAKE) clean
	cd doc; $(MAKE) clean
	cd ext; $(MAKE) clean

distclean : clean
	cd gc; $(MAKE) distclean
	cd src; $(MAKE) distclean
	cd lib; $(MAKE) distclean
	cd doc; $(MAKE) distclean
	cd ext; $(MAKE) distclean
	rm -rf $(CONFIG_GENERATED)

install-all : install install-doc

install :
	cd src; $(MAKE) install
	cd lib; $(MAKE) install
	cd ext; $(MAKE) install
	$(INSTALL) -m 444 aclocal.m4 `sh src/gauche-config --ac`/aclocal.m4
	cd doc; $(MAKE) install
	cd lib; $(MAKE) slibcat

install-doc :
	cd doc; $(MAKE) install

install-rpm :
	cd src; $(MAKE) install
	cd lib; $(MAKE) install
	cd ext; $(MAKE) install
	$(INSTALL) -m 444 aclocal.m4 `sh src/gauche-config --ac`/aclocal.m4

realclean : clean
	cd gc; $(MAKE) distclean; rm -rf configure autom4te*.cache
	cd src; $(MAKE) realclean
	cd lib; $(MAKE) realclean
	cd doc; $(MAKE) realclean
	cd ext; $(MAKE) realclean
	rm -rf $(CONFIG_GENERATED) configure INSTALL INSTALL.eucjp DIST_EXCLUDE_X

uninstall :
	cd src; $(MAKE) uninstall
	cd doc; $(MAKE) uninstall
