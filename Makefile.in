# Top Makefle for Gauche
# $Id: Makefile.in,v 1.41 2003-07-22 05:09:22 shirok Exp $
#  Run 'configure' script to generate Makefile

.PHONY: all test check install uninstall clean distclean maintainer-clean install-check

@SET_MAKE@
SHELL       = @SHELL@
prefix      = @prefix@
exec_prefix = @exec_prefix@
bindir      = @bindir@
libdir      = @libdir@
srcdir      = @srcdir@

SUBDIRS = gc lib src ext doc
INSTALL = @INSTALL@
GAUCHE_VERSION  = @GAUCHE_VERSION@
GAUCHE_DATA_DIR = @datadir@/gauche
DESTDIR =

CONFIG_GENERATED = Makefile config.cache config.log config.status libtool \
	           autom4* gc/autom4*
AUTOCONF_GENERATED = $(CONFIG_GENERATED) configure

all:
	for d in $(SUBDIRS); do (cd $$d; $(MAKE) all); done

test : check

check:
	for d in $(SUBDIRS); do (cd $$d; $(MAKE) check); done

install:
	for d in lib src ext doc; do (cd $$d; $(MAKE) install); done
	$(INSTALL) -m 444 acinclude.m4 $(DESTDIR)`sh src/gauche-config --ac`/aclocal.m4
	cd lib; $(MAKE) slibcat

install-doc:
	cd doc; $(MAKE) install

install-pkg:
	cd src; $(MAKE) install
	cd lib; $(MAKE) install
	cd ext; $(MAKE) install
	$(INSTALL) -m 444 acinclude.m4 $(DESTDIR)`sh src/gauche-config --ac`/aclocal.m4

uninstall:
	for d in $(SUBDIRS); do (cd $$d; $(MAKE) uninstall); done

clean:
	rm -rf test.log core *~
	for d in $(SUBDIRS); do (cd $$d; $(MAKE) clean); done

distclean: clean
	for d in $(SUBDIRS); do (cd $$d; $(MAKE) distclean); done
	rm -rf $(CONFIG_GENERATED)

maintainer-clean: clean
	for d in $(SUBDIRS); do (cd $$d; $(MAKE) maintainer-clean); done
	rm -rf $(AUTOCONF_GENERATED) VERSION

dist:
	@echo "To create a distribution tarball, use DIST script."

distcheck:
	@echo "To create a distribution tarball, use DIST script."

install-check: install
	@echo "Testing installed Gauche"
	@rm -rf test.log
	@(cd src; $(MAKE) install-check) >> test.log
	@(cd ext; $(MAKE) install-check) >> test.log

# NB: I intentionally make aclocal.m4 not depend on acinclude.m4, to
# prevent aclocal from running accidentally.
aclocal.m4 :
	@echo "************************************************************"
	@echo "To rebuild aclocal.m4 from acinclude.m4, follow the instructions"
	@echo "below:"
	@echo " - Make sure you have libtool 1.5, or you'll be in deep trouble"
	@echo " - Run aclocal"
	@echo " - Edit aclocal.m4 so that always_export_symbols libtool parameter"
	@echo "   shall be 'yes' on cygwin platforms.  (Don't change the default"
	@echo "   value.  There are two occurrences of setting the parameter in"
	@echo "   case statement when the target platform is cygwin.)"
	@echo "************************************************************"


