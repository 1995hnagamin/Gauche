srcdir       = @srcdir@
top_builddir = @top_builddir@
top_srcdir   = @top_srcdir@

include ../Makefile.ext

SCM_CATEGORY = dbm

LIBFILES = @DBM_ARCHFILES@
SCMFILES = @DBM_SCMFILES@

GENERATED = Makefile gdbm.c ndbm.c odbm.c *_head.c *_tail.c dbmconf.h

all : $(LIBFILES)

gdbm_OBJECTS   = gdbm_head.$(OBJEXT) gdbm.$(OBJEXT) gdbm_tail.$(OBJEXT)

gdbm.$(SOEXT) : $(gdbm_OBJECTS)
	$(MODLINK) gdbm.$(SOEXT) $(gdbm_OBJECTS) $(EXT_LIBGAUCHE) @GDBMLIB@ $(LIBS)

gdbm.c : gdbm.stub

ndbm_OBJECTS   = ndbm_head.$(OBJEXT) ndbm.$(OBJEXT) ndbm_tail.$(OBJEXT)

ndbm.$(SOEXT) : $(ndbm_OBJECTS)
	$(MODLINK) ndbm.$(SOEXT) $(ndbm_OBJECTS) $(EXT_LIBGAUCHE) @NDBMLIB@ $(LIBS)

ndbm.c : ndbm.stub

odbm_OBJECTS   = odbm_head.$(OBJEXT) odbm.$(OBJEXT) odbm_tail.$(OBJEXT)

odbm.$(SOEXT) : $(odbm_OBJECTS)
	$(MODLINK) odbm.$(SOEXT) $(odbm_OBJECTS) $(EXT_LIBGAUCHE) @ODBMLIB@ $(LIBS)

odbm.c : odbm.stub

gdbm_head.c gdbm_tail.c :
	$(GAUCHE_CONFIG) --fixup-extension gdbm

ndbm_head.c ndbm_tail.c :
	$(GAUCHE_CONFIG) --fixup-extension ndbm

odbm_head.c odbm_tail.c :
	$(GAUCHE_CONFIG) --fixup-extension odbm

install-dbm :
	$(INSTALL) -m 444 dbm.scm $(GAUCHE_LIBDIR)

install : install-dbm install-std

