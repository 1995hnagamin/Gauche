.SUFFIXES: .stub .c

CC = @CC@
CFLAGS = @DEFS@ @CFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
GOSH = @GOSH@
GAUCHE_CONFIG = @GAUCHE_CONFIG@
GAUCHE_TOP = @GAUCHE_TOP@
INSTALL = @INSTALL@

ARCHFILES = @ARCHFILES@
SCMFILES = @SCMFILES@
HEADERS = 

TARGET = @ARCHFILES@
CONFIG_GENERATED = Makefile config.cache config.log config.status dbmconfig.h
GENERATED = gdbm.c ndbm.c odbm.c bsddb.c

INSTALL_TYPE = @INSTALL_TYPE@
HEADER_INSTALL_DIR  = `$(GAUCHE_CONFIG) --$(INSTALL_TYPE)incdir`
SCM_INSTALL_DIR     = `$(GAUCHE_CONFIG) --$(INSTALL_TYPE)libdir`
ARCH_INSTALL_DIR    = `$(GAUCHE_CONFIG) --$(INSTALL_TYPE)archdir`

all : $(TARGET)

.stub.c :
	$(GOSH) genstub $<

gdbm.so : gdbm.o
	$(CC) $(LDFLAGS) gdbm.so gdbm.o @GDBMLIB@ $(LIBS)

ndbm.so : ndbm.o
	$(CC) $(LDFLAGS) ndbm.so ndbm.o @NDBMLIB@ $(LIBS)

odbm.so : odbm.o
	$(CC) $(LDFLAGS) odbm.so odbm.o @ODBMLIB@ $(LIBS)

bdbm.so : bdbm.o bsddb.o
	$(CC) $(LDFLAGS) odbm.so bdbm.o bsddb.o @BDBMLIB@ $(LIBS)

test : all
	@rm -f test.log
	$(GOSH) test.scm > test.log

install : all
	@for f in $(HEADERS) _end; do \
	  if test $$f != _end; then \
	    $(INSTALL) -m 444 $$f $(HEADER_INSTALL_DIR); \
	  fi; \
	done
	@$(INSTALL) -m 444 dbm.scm $(SCM_INSTALL_DIR)
	@$(INSTALL) -d $(SCM_INSTALL_DIR)/dbm
	@for f in $(SCMFILES) _end; do \
	  if test $$f != _end; then \
	    $(INSTALL) -m 444 $$f $(SCM_INSTALL_DIR)/dbm/; \
	  fi; \
	done
	@for f in $(ARCHFILES) _end; do \
	  if test $$f != _end; then \
	    $(INSTALL) -m 555 $$f $(ARCH_INSTALL_DIR); \
	  fi; \
	done

clean :
	rm -rf core $(TARGET) $(GENERATED) *.o *~ test.log so_locations

distclean : clean
	rm -rf $(CONFIG_GENERATED)

realclean : clean
	rm -rf $(CONFIG_GENERATED) configure




