srcdir       = @srcdir@
top_builddir = @top_builddir@
top_srcdir   = @top_srcdir@

include ../Makefile.ext

SCM_CATEGORY = dbm

LIBFILES = @DBM_ARCHFILES@
SCMFILES = @DBM_SCMFILES@

GENERATED = Makefile dbmconf.h
XCLEANFILES = gdbm.c ndbm.c odbm.c ndbm-makedb ndbm-suffixes.h *_head.c *_tail.c

all : $(LIBFILES)

gdbm_OBJECTS   = gdbm_head.$(OBJEXT) gdbm.$(OBJEXT) gdbm_tail.$(OBJEXT)

gdbm.$(SOEXT) : $(gdbm_OBJECTS)
	$(MODLINK) gdbm.$(SOEXT) $(gdbm_OBJECTS) $(EXT_LIBGAUCHE) @GDBMLIB@ $(LIBS)

gdbm.c : gdbm.stub

ndbm_OBJECTS   = ndbm_head.$(OBJEXT) ndbm.$(OBJEXT) ndbm_tail.$(OBJEXT)

ndbm.$(SOEXT) : $(ndbm_OBJECTS)
	$(MODLINK) ndbm.$(SOEXT) $(ndbm_OBJECTS) $(EXT_LIBGAUCHE) @NDBMLIB@ $(LIBS)

ndbm.c : ndbm.stub
ndbm.$(OBJEXT): ndbm.c ndbm-suffixes.h

odbm_OBJECTS   = odbm_head.$(OBJEXT) odbm.$(OBJEXT) odbm_tail.$(OBJEXT)

odbm.$(SOEXT) : $(odbm_OBJECTS)
	$(MODLINK) odbm.$(SOEXT) $(odbm_OBJECTS) $(EXT_LIBGAUCHE) @ODBMLIB@ $(LIBS)

odbm.c : odbm.stub

gdbm_head.c gdbm_tail.c :
	$(GAUCHE_CONFIG) --fixup-extension gdbm

ndbm_head.c ndbm_tail.c :
	$(GAUCHE_CONFIG) --fixup-extension ndbm

odbm_head.c odbm_tail.c :
	$(GAUCHE_CONFIG) --fixup-extension odbm

# auxiliary stuff.
# a bit tricky,
ndbm-makedb : ndbm-makedb.c
	$(CC) $(DEFS) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) -o ndbm-makedb \
	  ndbm-makedb.c $(LOCAL_LFLAGS) $(XLDFLAGS) @NDBMLIB@ $(LIBS)

ndbm-suffixes.h : ndbm-makedb ndbm-suffixes.scm
	$(GOSH) ./ndbm-suffixes.scm ndbm-suffixes.h

install : install-std

