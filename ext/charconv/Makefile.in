srcdir       = @srcdir@
top_builddir = @top_builddir@
top_srcdir   = @top_srcdir@

GENERATED = Makefile charconv.h eucj2ucs.c ucs2eucj.c guess_tab.c
XCLEANFILES = convlib.c convaux.c charconv_head.c charconv_tail.c 
PRE_PACKAGE_FILES = eucj2ucs.c guess_tab.c pre-package-data

include ../Makefile.ext

XCPPFLAGS = @ICONV_CPPFLAGS@
XLDFLAGS  = @ICONV_LDFLAGS@
XLIBS     = @ICONV_LIB@

SCM_CATEGORY = gauche

LIBFILES = libcharconv.$(SOEXT)
SCMFILES = charconv.scm

OBJECTS = charconv_head.$(OBJEXT) \
          charconv.$(OBJEXT)      \
          convlib.$(OBJEXT)       \
          convaux.$(OBJEXT)       \
          jconv.$(OBJEXT)         \
          guess.$(OBJEXT)         \
          charconv_tail.$(OBJEXT)

all : $(LIBFILES)

libcharconv.$(SOEXT) : $(OBJECTS)
	$(MODLINK) libcharconv.$(SOEXT) $(OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

charconv_head.c charconv_tail.c :
	$(GAUCHE_CONFIG) --fixup-extension charconv

convlib.c : convlib.stub

convaux.c : convaux.scm
	$(GENCOMP) convaux.scm

jconv.$(OBJEXT) : eucj2ucs.c ucs2eucj.c jconv.c

guess.$(OBJEXT) : guess_tab.c guess.c

eucj2ucs.c ucs2eucj.c : cvt.scm euc-jp-2000-std.txt
	$(GOSH) cvt.scm

guess_tab.c : guess.scm
	$(GOSH) guess.scm guess_tab.c

pre-package-data :
	cd data; $(MAKE) GOSH=$(GOSH)

install : install-std


