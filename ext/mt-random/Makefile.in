CC = @CC@
CFLAGS = @CFLAGS@ -I../uvector
LDFLAGS = @LDFLAGS@ 
LIBS = @LIBS@
GOSH = @GOSH@
GAUCHE_CONFIG = @GAUCHE_CONFIG@
GAUCHE_TOP = @GAUCHE_TOP@
INSTALL = @INSTALL@

ARCHFILES = mt-random.so
SCMFILES = mt-random.scm
HEADERS = 

TARGET = mt-random.so
OBJS = mt-random_head.o mt-random.o mt-lib.o mt-random_tail.o
CONFIG_GENERATED = Makefile config.cache config.log config.status \
		   autom4te.cache mt-random_head.o mt-random_tail.o

INSTALL_TYPE = @INSTALL_TYPE@
HEADER_INSTALL_DIR  = `$(GAUCHE_CONFIG) --$(INSTALL_TYPE)incdir`
SCM_INSTALL_DIR     = `$(GAUCHE_CONFIG) --$(INSTALL_TYPE)libdir`/math
ARCH_INSTALL_DIR    = `$(GAUCHE_CONFIG) --$(INSTALL_TYPE)archdir`

all : $(TARGET)

mt-random.so : $(OBJS)
	$(CC) $(LDFLAGS) mt-random.so $(OBJS) $(LIBS)

mt-lib.c : mt-lib.stub
	$(GOSH) genstub mt-lib.stub

test : all
	@rm -f test.log
	$(GOSH) test.scm > test.log

install : all
	@for f in $(HEADERS) _end; do \
	  if test $$f != _end; then \
	    $(INSTALL) -m 444 $$f $(HEADER_INSTALL_DIR); \
	  fi; \
	done
	@for f in $(SCMFILES) _end; do \
	  if test $$f != _end; then \
	    $(INSTALL) -m 444 $$f $(SCM_INSTALL_DIR); \
	  fi; \
	done
	@for f in $(ARCHFILES) _end; do \
	  if test $$f != _end; then \
	    $(INSTALL) -m 555 $$f $(ARCH_INSTALL_DIR); \
	  fi; \
	done

clean :
	rm -rf core $(TARGET) $(OBJS) *~ test.log so_locations mt-lib.c

distclean : clean
	rm -rf $(CONFIG_GENERATED)

realclean : clean
	rm -rf $(CONFIG_GENERATED) configure

# 'link' creates symlinks from source tree to extension modules, so that
# it can be tested within the source tree.  'unlink' removes them.
# these are only for developer's.

link : $(TARGET) $(SCMFILES)
	$(GOSH) ../xlink -d math -l $(TARGET) $(SCMFILES)

unlink :
	$(GOSH) ../xlink -d math -u $(TARGET) $(SCMFILES)



