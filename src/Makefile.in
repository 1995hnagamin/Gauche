SCM = snow
CC = cc
CFLAGS = -g -I. -I../gc -I../gc/include
#CFLAGS = -O2 -I. -I../gc -I../gc/include
LDFLAGS = -lm
AR = ar

GENERATED = stdlib.c extlib.c

INSTALL_HEADERS = gauche.h gauche/vm.h gauche/vminsn.h gauche/vminline.h \
	          gauche/char_euc_jp.h memory.h

INSTALL_LIBS = libgauche.a libgc.a

OBJS = core.o vm.o compile.o error.o inline.o class.o boolean.o char.o \
       string.o list.o port.o hash.o write.o read.o vector.o symbol.o \
       module.o proc.o number.o io.o load.o promise.o repl.o stdlib.o extlib.o

.SUFFIXES: .stub

.stub.c:
	$(SCM) genstub $<

HDRS = gauche.h

all : gosh

gosh : libgauche.a main.o
	$(CC) $(CFLAGS) -o gosh main.o -L. -lgauche ../gc/gc.a $(LDFLAGS)

$(OBJS) main.o : $(HDRS)

stdlib.c : stdlib.stub
extlib.c : extlib.stub

libgauche.a : $(OBJS)
	$(AR) r libgauche.a $(OBJS)

clean :
	rm -f core gosh *.o *~ *.a $(GENERATED) gauche/*~

install : all

