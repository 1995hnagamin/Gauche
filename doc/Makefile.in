MANPAGES = gosh.1 gauche-config.1
EXTRACTED = gauche-refe.texi gauche-refj.texi
GENERATED = Makefile $(MANPAGES)
GOSH = ../src/gosh -I../src -I../lib
INSTALL = @INSTALL@
MAKEINFO = @MAKEINFO@
GZIP_PROGRAM = @GZIP_PROGRAM@

# Manual page destination.  Default @mandir@ doesn't include 'share'
# in the path, so I redefine it---a user can still override it by
# make mandir=wherever
prefix  = @prefix@
datadir = @datadir@
mandir  = @mandir@/man1
infodir = @infodir@

all: info

install: all
	if test ! -d $(mandir); then $(INSTALL) -d $(mandir); fi
	for m in $(MANPAGES); do \
	  $(INSTALL) -m 444 $$m $(mandir)/; \
	done
	if test ! -d $(infodir); then $(INSTALL) -d $(infodir); fi
	if test -f gauche-refe.info.gz -o -f gauche-refj.info.gz; then \
	  for info in *.info*; do \
	    $(INSTALL) -m 444 $$info $(infodir)/; \
	  done; \
	fi

uninstall:
	(cd $(mandir); rm -rf $(MANPAGES))
	(cd $(infodir); \
	 if test -f gauche-refe.info -o -f gauche-refe.info.gz; \
	   then rm -rf gauche-refe.*; \
	 fi; \
	 if test -f gauche-refj.info -o -f gauche-refj.info.gz; \
	   then rm -rf gauche-refj.*; \
	 fi)

texi : gauche-refe.texi gauche-refj.texi

html : gauche-refe.html gauche-refj.html

htmls : gauche-refe_toc.html gauche-refj_toc.html

dvi : gauche-refe.dvi

pdf : gauche-refe.pdf

info : gauche-refe.info.gz gauche-refj.info.gz

gauche-refe.html : gauche-refe.texi
	texi2html -number gauche-refe.texi

gauche-refe_toc.html : gauche-refe.texi
	texi2html -split section -number gauche-refe.texi

gauche-refe.dvi : gauche-refe.texi
	texi2dvi gauche-refe.texi

gauche-refe.pdf : gauche-refe.texi
	texi2pdf gauche-refe.texi

gauche-refe.texi : gauche-ref.texi extract
	gosh ./extract -en -o gauche-refe.texi gauche-ref.texi

gauche-refe.info.gz : gauche-refe.texi
	if test X$(MAKEINFO) != X -a X$(GZIP_PROGRAM) != X; then \
	  $(MAKEINFO) --no-warn gauche-refe.texi; \
	  rm -rf gauche-refe.info*.gz; \
	  $(GZIP_PROGRAM) gauche-refe.info gauche-refe.info-[0-9]*; \
	fi

gauche-refj.html : gauche-refj.texi
	texi2html -number gauche-refj.texi

# the sed stuff fixes broken charset spec
gauche-refj_toc.html : gauche-refj.texi
	texi2html -split section -number gauche-refj.texi;
	for f in gauche-refj*.html; do \
	  sed -e '1d;s/LANG=""//;s|^<HEAD>$$|<html><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp">|' $$f > $$f.t && mv $$f.t $$f; \
	done

ngauche-refj.dvi : gauche-refj.texi
	texi2dvi gauche-refj.texi

gauche-refj.pdf : gauche-refj.texi
	texi2pdf gauche-refj.texi

gauche-refj.texi : gauche-ref.texi extract
	gosh ./extract -jp -o gauche-refj.texi gauche-ref.texi

gauche-refj.info.gz : gauche-refj.texi
	if test X$(MAKEINFO) != X -a X$(GZIP_PROGRAM) != X; then \
	  $(MAKEINFO) --no-warn gauche-refj.texi; \
	  rm -rf gauche-refj.info*.gz; \
	  $(GZIP_PROGRAM) gauche-refj.info gauche-refj.info-[0-9]*; \
	fi

libgauche-refe.texi : libgauche-ref.texi extract
	gosh ./extract -en -o libgauche-refe.texi libgauche-ref.texi

libgauche-refe.html : libgauche-refe.texi
	texi2html -number libgauche-refe.texi

libgauche-refe.info.gz : libgauche-refe.texi
	if test X$(MAKEINFO) != X -a X$(GZIP_PROGRAM) != X; then \
	  $(MAKEINFO) --no-warn libgauche-refe.texi; \
	  rm -rf libgauche-refe.info*.gz; \
	  $(GZIP_PROGRAM) libgauche-refe.info libgauche-refe.info-[0-9]*; \
	fi

clean:
	rm -rf core *~ *.aux *.cl *.cls *.cp *.fn *.fns *.ky *.log *.md *.mds \
	       *.pg *.toc *.tp *.tps *.vr *.vrs *.pdf *.dvi *.info*

distclean : clean
	rm -rf $(GENERATED)

realclean : clean
	rm -f gauche-ref*.html gauche-ref*.dvi libgauche-ref*.html libgauche-ref*.dvi Makefile $(GENERATED) $(EXTRACTED)
